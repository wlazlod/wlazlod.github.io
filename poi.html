<!doctype html>
<html lang="pl">
  <head>
  	<title>Świdnik - mapa mobilności</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">
		
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="css/style.css">
		<script src="js/echarts.min.js"></script>
		
  </head>
  <body>
		
	<div class="wrapper d-flex align-items-stretch">
		<nav id="sidebar">
		<div class="custom-menu">
			<button type="button" id="sidebarCollapse" class="btn btn-primary">
				<i class="fa fa-bars"></i>
				<span class="sr-only">Toggle Menu</span>
			</button>
		</div>
		<div class="p-4">
	  		<h1><a href="index.html" class="logo">Świdnik <span>Wspomaganie mobilności</span></a></h1>
			<ul class="list-unstyled components mb-5">
			<li>
				<a href="index.html"><span class="fa fa-map-o mr-3"></span> Mapa Mobilności</a>
			</li>
			<li>
				<a href="#groupSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle"><span class="fa fa-clone mr-3" ></span> Kategorie </a>
				<ul class="collapse list-unstyled" id="groupSubmenu">
				<li>
					<a href="#buildingsSubSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle"><i class="fa fa-building"></i> Budynki</a>
					<ul class="collapse list-unstyled" id="buildingsSubSubmenu">
						<li> <a href="groups_template.html"><i class="fa fa-shopping-cart"></i> Centra handlowe</a> </li>
						<li> <a href="groups_template.html"><i class="fa fa-plus"></i> Kościoły</a> </li>
						<li> <a href="groups_template.html"><i class="fa fa-graduation-cap"></i> Szkoły</a> </li>
						<li> <a href="groups_template.html"><i class="fa fa-university"></i> Urzędy</a> </li>
						<li> <a href="groups_template.html"><i class="fa fa-industry"></i> Zakłady Pracy</a> </li>
					</ul>
				</li>
				<li> <a href="groups_template.html"><i class="fa fa-tree"></i> Parki</a> </li>                    
				<li> <a href="groups_template.html?group=bus_stops"><i class="fa fa-bus"></i> Przystanki</a> </li>
				<li> <a href="groups_template.html"><i class="fa fa-road"></i> Ulice</a> </li>
				<li> <a href="groups_template.html"><i class="fa fa-bicycle"></i> Ścieżki rowerowe</a> </li>
					
				</ul>
			</li>
			<li class = "active">
				<a href="#poiSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle"><span class="fa fa-map-marker mr-3"></span> Punkty</a>
				<ul class="collapse list-unstyled" id="poiSubmenu">
				<li> <a href="poi.html?id=gen_okulickiego_1"><i class="fa fa-bus"></i> Generała Okulickiego 1</a> </li>
				<li> <a href="poi.html?id=gen_okulickiego_2"><i class="fa fa-bus"></i> Generała Okulickiego 2</a> </li>
				<li> <a href="poi.html?id=jana_pawla_2"><i class="fa fa-bus"></i> Jana Pawła 2</a> </li>
				<li> <a href="poi.html?id=kino_lot"><i class="fa fa-bus"></i> Kino Lot</a> </li>
				<li> <a href="poi.html?id=klonowa_kosciol"><i class="fa fa-bus"></i> Klonowa - Kościół</a> </li>
				<li> <a href="poi.html?id=kosynierow_1"><i class="fa fa-bus"></i> Kosynierów 1</a> </li>
				<li> <a href="poi.html?id=kosynierow_2"><i class="fa fa-bus"></i> Kosynierów 2</a> </li>
				<li> <a href="poi.html?id=kusocinskiego"><i class="fa fa-bus"></i> Kusocińskiego</a> </li>
				<li> <a href="poi.html?id=lotnikow_polskich_dzialki"><i class="fa fa-bus"></i> Lotników Polskich - Działki</a> </li>
				<li> <a href="poi.html?id=lotnikow_polskich_stacja_paliw"><i class="fa fa-bus"></i> Lotników Polskich - Stacja Paliw</a> </li>
				<li> <a href="poi.html?id=lotnikow_polskich_szpital"><i class="fa fa-bus"></i> Lotników Polskich - Szpital</a> </li>
				<li> <a href="poi.html?id=nadlesnictwo_swidnik"><i class="fa fa-bus"></i> Nadleśnictwo Świdnik</a> </li>
				<li> <a href="poi.html?id=niepodleglosci_1"><i class="fa fa-bus"></i> Niepodległości 1</a> </li>
				<li> <a href="poi.html?id=niepodleglosci_szpital"><i class="fa fa-bus"></i> Niepodległości 2</a> </li>
				<li> <a href="poi.html?id=raclawicka_1"><i class="fa fa-bus"></i> Racławicka 1</a> </li>
				<li> <a href="poi.html?id=raclawicka_2"><i class="fa fa-bus"></i> Racławicka 2</a> </li>
				<li> <a href="poi.html?id=swidnik_helikopter"><i class="fa fa-bus"></i> Świdnik Helikopter</a> </li>
				<li> <a href="poi.html?id=swidnik_stadion"><i class="fa fa-bus"></i> Świdnik Stadion</a> </li>
				<li> <a href="poi.html?id=wyszynskiego_cmentarz"><i class="fa fa-bus"></i> Wyszyńskiego 1</a> </li>
				<li> <a href="poi.html?id=wyszynskiego_wiejska"><i class="fa fa-bus"></i> Wyszyńskiego 2</a> </li>
				<li> <a href="poi.html?id=zwirki_i_wigury"><i class="fa fa-bus"></i> Żwirki i Wigury</a> </li>

				</ul>
			</li>
			<li>
				<a href="add.html"><span class="fa fa-camera-retro mr-3"></span>Analiza obrazu</a>
			</li>
			<li>
				<a href="about.html"><span class="fa fa-user mr-3"></span>O projekcie</a>
			</li>
			<li>
				<a href="contact.html"><span class="fa fa-paper-plane mr-3"></span>Kontakt</a>
			</li>
			</ul>
			
			<div class="footer">
				<p> Copyright by AiRonmen &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved </p>
			
			</div>

		</div>
		</nav>

        <!-- Page Content  -->
      <div id="content" class="p-4 p-md-5 pt-5">
        <h2 class="mb-4" id="name"></h2>
		<div class="row">
		  <div class="col-sm-6" id="barchart" style="width: 100%; min-height: 400px">
		  </div>  
		  <div class="col-sm-6" id="piecalendar" style="width: 100%; min-height: 400px">
		  </div>
		</div>
		<div class="row">
		  <div class="col-sm-6">
		  </div>  
		  <div class="col-sm-6">
			<p class="font-italic text-center">*Dane wygenerowane losowo</p>
		  </div>
		</div>
		
      </div>
	</div>
		
	<script>
				const queryString = window.location.search;

				const urlParams = new URLSearchParams(queryString);
				const id = urlParams.get('id')
				
				var xhr = new XMLHttpRequest();
				var url = "https://vj8jq3kuo9.execute-api.us-east-2.amazonaws.com/prod/poi_info/" + id;
				xhr.open("GET", url, true);
				
				xhr.send();
				
				xhr.onload = function() {
					if (xhr.status != 200) { // analyze HTTP status of the response
						name = "Nieznany POI";
						alert(`Error ${xhr.status}: ${xhr.statusText}`); // e.g. 404: Not Found
					} else { // show the result
						answer = JSON.parse(xhr.responseText);
						console.log(JSON.parse(xhr.responseText))
						name = answer.poi_name;
						barChartBus(answer.bus_occupancy)
						chartSeries(answer.car_occupancy)
					}
					document.getElementById("name").innerHTML = name;
					
				};
				
				

        // specify chart configuration item and data
				
				function timeConverter(UNIX_timestamp){
					  var a = new Date(UNIX_timestamp * 1000);
					  var year = a.getFullYear();
					  var month = a.getMonth();
					  var date = a.getDate();
					  var hour = a.getHours().toLocaleString('en-US', {minimumIntegerDigits: 2, useGrouping:false});
					  var min = a.getMinutes().toLocaleString('en-US', {minimumIntegerDigits: 2, useGrouping:false});
					  var sec = a.getSeconds();
					  var time = year + '/' + month + '/' + date + ' ' + hour + ':' + min
					  return time;
				}
				
				function barChartBus(data) {
				
					var myChart = echarts.init(document.getElementById('barchart'));
					
					console.log(data)
					data_list = [['Data', 'Zapełnienie autobusu na przystanku']]
					for (x of data) {
						data_list = data_list.concat([[timeConverter(x.ts), x.val]])
					}
					console.log(data_list)
					
					var option = {
						legend: {},
						tooltip: {},
						dataset: {
							source: data_list
						},
						xAxis: {type: 'category'},
						yAxis: {},
						// Declare several bar series, each will be mapped
						// to a column of dataset.source by default.
						series: [
							{type: 'bar'}
						]
					};


					// use configuration item and data specified to show chart
					myChart.setOption(option);
					
					window.onresize = function() {
						myChart.resize();
					};
				}
				
				function chartSeries(data){
					var dom = document.getElementById("piecalendar");
					var myChart = echarts.init(dom);
					var app = {};
					option = null;
					var cellSize = [60, 60];
					var pieRadius = 25;

					function getVirtulData() {
						var date = +echarts.number.parseDate('2017-02-01');
						var end = +echarts.number.parseDate('2017-03-01');
						var dayTime = 3600 * 24 * 1000;
						var data = [];
						for (var time = date; time < end; time += dayTime) {
							data.push([
								echarts.format.formatTime('yyyy-MM-dd', time),
								Math.floor(Math.random() * 10000)
							]);
						}
						return data;
					}

					function getPieSeries(scatterData, chart) {
						return echarts.util.map(scatterData, function (item, index) {
							var center = chart.convertToPixel('calendar', item);
							return {
								id: index + 'pie',
								type: 'pie',
								center: center,
								label: {
									normal: {
										formatter: '{c}',
										position: 'inside'
									}
								},
								radius: pieRadius,
								data: [
									{name: 'samochody', value: Math.round(Math.random() * 24)},
									{name: 'rowery', value: Math.round(Math.random() * 24)},
									{name: 'piesi', value: Math.round(Math.random() * 24)}
								]
							};
						});
					}

					function getPieSeriesUpdate(scatterData, chart) {
						return echarts.util.map(scatterData, function (item, index) {
							var center = chart.convertToPixel('calendar', item);
							return {
								id: index + 'pie',
								center: center
							};
						});
					}

					var scatterData = getVirtulData();

					option = {
						tooltip : {},
						legend: {
							data: ['samochody', 'rowery', 'piesi'],
							bottom: 20
						},
						calendar: {
							top: 'middle',
							left: 'center',
							orient: 'vertical',
							cellSize: cellSize,
							yearLabel: {
								show: false,
								textStyle: {
									fontSize: 30
								}
							},
							dayLabel: {
								margin: 20,
								firstDay: 1,
								nameMap: ['nd', 'pn', 'wt', 'śr', 'cz', 'pt', 'sb']
							},
							monthLabel: {
								show: false
							},
							range: ['2017-02']
						},
						series: [{
							id: 'label',
							type: 'scatter',
							coordinateSystem: 'calendar',
							symbolSize: 1,
							label: {
								normal: {
									show: true,
									formatter: function (params) {
										return echarts.format.formatTime('dd', params.value[0]);
									},
									offset: [-cellSize[0] / 2 + 10, -cellSize[1] / 2 + 10],
									textStyle: {
										color: '#000',
										fontSize: 14
									}
								}
							},
							data: scatterData
						}]
					};

					var pieInitialized;
					setTimeout(function () {
						pieInitialized = true;
						myChart.setOption({
							series: getPieSeries(scatterData, myChart)
						});
					}, 10);

					app.onresize = function () {
						if (pieInitialized) {
							myChart.setOption({
								series: getPieSeriesUpdate(scatterData, myChart)
							});
						}
						myChart.resize();
					};
					
					if (option && typeof option === "object") {
						myChart.setOption(option, true);
					}
				}
	</script> 
    <script src="js/jquery.min.js"></script>
    <script src="js/popper.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/main.js"></script>
  </body>
</html>